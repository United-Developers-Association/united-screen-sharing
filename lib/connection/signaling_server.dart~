import 'dart:convert';
import 'dart:io' if (dart.library.js_util) 'dart:js';

import 'package:united_screen_sharing/connection/signaling_requirements.dart';


class SignalingServer {
    /// If passwordHash is not null, the server will require authentication. Needs to be pre-hashed using md5
    String? passwordHash;

    // IP address and port that the server will be listening to
    String listeningAddress;
    int listeningPort = 19083;
    bool useSecureProtocol = false;

    SignalingServer(this.listeningAddress, {this.listeningPort, this.passwordHash, this.useSecureProtocol}, ...this.ipRestrictions);

    WebSocket? _socket;

    Future<void> startListening() async {
        _socket = await WebSocket("${useSecureProtocol ? "wss" : "ws"}://${listeningAddress}:${listeningPort}");

        _socket.onClose = onConnectionFinished;
        _socket.onMessage = onMessageReceived;
        _socket.onOpen = onConnectionEstablished;

        onConnectionListening();
    }

    Future<void> stopListening() {
        await _socket.close();

        onConnectionFinished();
    }

    void onMessageReceived(msg) {
        
    }

    Function()? onConnectionListening;
    Function()? onConnectionEstablished;
    Function(Error? error)? onError;
    Function()? onConnectionFinished;
}

